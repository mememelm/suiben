import { Injectable} from '@angular/core';
import { Exploitant } from "../constant/";
import { AngularFireDatabase, AngularFireList, AngularFireObject } from "@angular/fire/database";


@Injectable({
  providedIn: 'root'
})
export class ExploitantService {

  public urlExploitant = '/exploitants'
  exploitantsRef : AngularFireList<Exploitant> = null
  exploitantRefObj: AngularFireObject<any>  

  exploitantKey = this.angularFireDatabase.database.ref().child('exploitantId').push().key

  constructor(private angularFireDatabase: AngularFireDatabase) { }  

  // push exploitant
  createExploitant(exploitant: Exploitant){
    this.exploitantsRef.push(exploitant)   
  }

  // list exploitant
  getExploitantList(): AngularFireList<Exploitant>{
    return this.exploitantsRef = this.angularFireDatabase.list(this.urlExploitant,  ref => ref.orderByChild('exploitantDate'))
  }

  // get by Id
  getExploitantById(key: string): AngularFireObject<Exploitant>{
    this.exploitantRefObj = this.angularFireDatabase.object('/exploitant/' + key) as AngularFireObject<Exploitant>  
    return this.exploitantRefObj
  }

  // update exploitant
  updateExploitant(exploitant: Exploitant){
    this.exploitantRefObj.update(exploitant)
  }

  // delete exploitant
  deleteById(key: string): Promise<void>{
    // this.exploitantRefObj = this.angularFireDatabase.object(this.urlExploitant + id)
    // this.exploitantRefObj.remove()
    // // this.angularFireDatabase.database.ref().child('/exploitants/'+key+'/').remove();
    if (this.exploitantsRef == null) {
      return this.angularFireDatabase.database.ref('/exploitant/' + key).remove()
    } else {
      return this.exploitantsRef.remove(key)
    }
  }
}

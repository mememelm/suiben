import { Component, OnInit} from '@angular/core';
import { ExploitantService } from "../../../services";
import { map } from "rxjs/operators";
import {MatDialog} from '@angular/material/dialog';
import { Exploitant } from 'src/app/constant';
import { ActivatedRoute } from '@angular/router';
import { ExploitantDetailComponent } from '../exploitant-detail/exploitant-detail.component';
import { DomaineCedarComponent } from '../../domaine/domaine-cedar.component';


@Component({
  selector: 'app-exploitant-list',
  templateUrl: './exploitant-list.component.html',
  styleUrls: ['./exploitant-list.component.css'],  
})
export class ExploitantListComponent implements OnInit {

  title = 'exploitants'
  exploitants: any
  exploitantsListNumber: number

  constructor(
    private exploitantService: ExploitantService, 
    private matDialog: MatDialog,
    private activatedRoute: ActivatedRoute,
  ) { }
  
  displayedColumnsExploitant = ['exploitant', 'competences', 'localisation', 'activity', 'specialite', 'action']
 
  ngOnInit(): void {     
    this.loadExploitantList()
  }

  loadExploitantList(){
    // this.exploitantService.getExploitantList().valueChanges()
    //   .subscribe(exploitants => {
    //       this.exploitants = exploitants
    //       this.exploitantsListNumber= exploitants.length
    //     }
    //   )
    this.exploitantService.getExploitantList().snapshotChanges().pipe(
      map(changes => changes.map(c => ({ key: c.payload.key, ...c.payload.val() })))
      ).subscribe(
        exploitants => {
          this.exploitants = exploitants
          this.exploitantsListNumber= exploitants.length
        }
    )
  }

  openDialogAddCedar(){
    this.matDialog.open(DomaineCedarComponent)
  }

  openDialogDetailsExploitant(){
    this.activatedRoute.paramMap
      .subscribe(params => {
        this.exploitants.forEach((p: Exploitant) => {
          if (p.key == p.exploitantId) { 
            this.exploitants = p
            console.log(p)
          }
        });
      })
  }
}